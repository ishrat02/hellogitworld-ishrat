name: Java Build with JUnit on Windows

on:
  push:
    branches:
      - main
      - '**'

jobs:
  build:
    runs-on: windows-latest

    steps:
    # 1. Checkout code
    - name: Checkout repository
      uses: actions/checkout@v3

    # 2. Set up Java
    - name: Set up JDK 17
      uses: actions/setup-java@v3
      with:
        distribution: temurin
        java-version: '17'

    # 3. Download JUnit & Hamcrest
    - name: Download JUnit
      shell: pwsh
      run: |
        Invoke-WebRequest "https://repo1.maven.org/maven2/junit/junit/4.13.2/junit-4.13.2.jar" -OutFile junit-4.13.2.jar
        Invoke-WebRequest "https://repo1.maven.org/maven2/org/hamcrest/hamcrest-core/1.3/hamcrest-core-1.3.jar" -OutFile hamcrest-core-1.3.jar

    # 4. Compile main and test code
    - name: Compile Java code with JUnit
      shell: pwsh
      run: |
        # Create output folder
        New-Item -ItemType Directory -Force -Path bin
        # Windows classpath separator is ';'
        $cp = ".\junit-4.13.2.jar;.\hamcrest-core-1.3.jar"
        # Compile all .java files including tests
        Get-ChildItem -Recurse -Filter *.java | ForEach-Object {
          javac -d bin -cp $cp $_.FullName
        }

    # 5. Run tests
    - name: Run JUnit tests
      shell: pwsh
      run: |
        java -cp "bin;junit-4.13.2.jar;hamcrest-core-1.3.jar" org.junit.runner.JUnitCore com.ambientideas.AppTest
